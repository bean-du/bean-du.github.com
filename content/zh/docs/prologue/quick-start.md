---
title: "å¿«é€Ÿå¼€å§‹"
description: "æ­¤é¡µé¢ä½ å°†å­¦ä¼šå¦‚ä½•ä½¿ç”¨ Phanes å¿«é€Ÿæ„å»ºä¸€ä¸ªå¾®æœåŠ¡é¡¹ç›®"
lead: "æ­¤é¡µé¢ä½ å°†å­¦ä¼šå¦‚ä½•ä½¿ç”¨ Phanes å¿«é€Ÿæ„å»ºä¸€ä¸ªå¾®æœåŠ¡é¡¹ç›®"
date: 2020-11-16T13:59:39+01:00
lastmod: 2020-11-16T13:59:39+01:00
draft: false
images: []
menu:
  docs:
    parent: "prologue"
weight: 110
toc: true
---

## å‰ç½®éœ€æ±‚

- [Git](https://git-scm.com/) â€” æœ€æ–°ç‰ˆæœ¬(å¿…éœ€)
- [Golang](https://go.dev/) â€” å¤§äº1.19(å¿…éœ€)
- [protoc](https://grpc.io/docs/protoc-installation/) â€” æœ€æ–°ç‰ˆæœ¬(éå¿…éœ€)
- [protoc-gen-go](https://grpc.io/docs/languages/go/quickstart/) â€” æœ€æ–°ç‰ˆæœ¬(éå¿…éœ€)
- [protoc-gen-go-grpc](https://grpc.io/docs/languages/go/quickstart/) â€” æœ€æ–°ç‰ˆæœ¬(éå¿…éœ€)
- [protoc-gen-micro](https://github.com/go-micro/cli/) â€” æœ€æ–°ç‰ˆæœ¬(éå¿…éœ€)

## å‰ç½®çŸ¥è¯†
- Go è¯­è¨€ç¼–ç¨‹åŸºç¡€
- å¾®æœåŠ¡åŸºç¡€

{{< details "ä»€ä¹ˆæ˜¯å¾®æœåŠ¡?" >}}
å¾®æœåŠ¡æ˜¯ä¸€ç§å¼€å‘è½¯ä»¶çš„æ¶æ„å’Œç»„ç»‡æ–¹æ³•ï¼Œå…¶ä¸­è½¯ä»¶ç”±é€šè¿‡æ˜ç¡®å®šä¹‰çš„API è¿›è¡Œé€šä¿¡çš„å°å‹ç‹¬ç«‹æœåŠ¡ç»„æˆã€‚ è¿™äº›æœåŠ¡ç”±å„ä¸ªå°å‹ç‹¬ç«‹å›¢é˜Ÿè´Ÿè´£ã€‚ å¾®æœåŠ¡æ¶æ„ä½¿åº”ç”¨ç¨‹åºæ›´æ˜“äºæ‰©å±•å’Œæ›´å¿«åœ°å¼€å‘ï¼Œä»è€ŒåŠ é€Ÿåˆ›æ–°å¹¶ç¼©çŸ­æ–°åŠŸèƒ½çš„ä¸Šå¸‚æ—¶é—´
{{< /details >}}


{{< details "ä»€ä¹ˆæ˜¯æœåŠ¡æ³¨å†Œ/æœåŠ¡å‘ç°?" >}}
ï¼ˆå¦‚ï¼šetcdï¼Œ consul ç­‰ï¼‰
æœåŠ¡æ³¨å†Œæ˜¯æŒ‡å¾®æœåŠ¡åœ¨å¯åŠ¨æ—¶ï¼Œå°†è‡ªå·±çš„ä¿¡æ¯æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒçš„è¿‡ç¨‹ï¼›æœåŠ¡å‘ç°æ˜¯æŒ‡æŸ¥è¯¢å¯ç”¨çš„å¾®æœåŠ¡åˆ—è¡¨åŠç½‘ç»œåœ°å€çš„æœºåˆ¶ æœåŠ¡é…ç½®ï¼šåŠ¨æ€ä¿®æ”¹æœåŠ¡é…ç½®ï¼Œå¹¶å°†å…¶æ¨é€åˆ°æœåŠ¡æä¾›è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…è€Œä¸éœ€è¦é‡å¯æœåŠ¡ã€‚ å¥åº·æ£€æŸ¥ï¼šæ³¨å†Œä¸­å¿ƒä½¿ç”¨ä¸€å®šçš„æœºåˆ¶å®šæ—¶æ£€æµ‹å·²æ³¨å†Œçš„æœåŠ¡ï¼Œå¦‚å‘ç°æŸå®ä¾‹é•¿æ—¶é—´æ— æ³•è®¿é—®ï¼Œå°±ä¼šä»æœåŠ¡æ³¨å†Œè¡¨ç§»é™¤è¯¥å®ä¾‹
{{< /details >}}

{{< details "ä»€ä¹ˆæ˜¯é…ç½®ä¸­å¿ƒ?" >}}
ã€Œé…ç½®ä¸­å¿ƒã€ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç”¨æ¥ç»Ÿä¸€ç®¡ç†é¡¹ç›®ä¸­æ‰€æœ‰é…ç½®çš„ç³»ç»Ÿã€‚ è™½ç„¶å¬èµ·æ¥å¾ˆç®€å•ï¼Œä½†ä¹Ÿä¸è¦å°ç§äº†è¿™ä¸ªæ¨¡å—ã€‚ å¦‚æœä¸€ä¸ªä¸­å‹äº’è”ç½‘é¡¹ç›®ï¼Œä¸é‡‡ç”¨é…ç½®ä¸­å¿ƒçš„æ¨¡å¼ï¼Œä¸€å¤§å †çš„å„ç±»é…ç½®é¡¹ï¼Œå„ç§ä¸å®šæ—¶çš„ä¿®æ”¹éœ€æ±‚ï¼Œä¸€å®šä¼šè®©å¼€å‘åŒå­¦éå¸¸å¤´ç–¼ä¸”ç®¡ç†ååˆ†æ··ä¹±ã€‚
{{< /details >}}

{{< details "ä»€ä¹ˆæ˜¯ rpc?" >}}
åˆ†å¸ƒå¼è®¡ç®—ä¸­ï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ˜¯ä¸€ä¸ªè®¡ç®—æœºé€šä¿¡åè®®ã€‚è¯¥åè®®å…è®¸è¿è¡Œäºä¸€å°è®¡ç®—æœºçš„ç¨‹åºè°ƒç”¨å¦ä¸€ä¸ªåœ°å€ç©ºé—´çš„å­ç¨‹åºï¼Œè€Œç¨‹åºå‘˜å°±åƒè°ƒç”¨æœ¬åœ°ç¨‹åºä¸€æ ·ï¼Œæ— éœ€é¢å¤–åœ°ä¸ºè¿™ä¸ªäº¤äº’ä½œç”¨ç¼–ç¨‹ã€‚RPCæ˜¯ä¸€ç§æœåŠ¡å™¨-å®¢æˆ·ç«¯æ¨¡å¼ï¼Œç»å…¸å®ç°æ˜¯ä¸€ä¸ªé€šè¿‡å‘é€è¯·æ±‚-æ¥å—å›åº”è¿›è¡Œä¿¡æ¯äº¤äº’çš„ç³»ç»Ÿ
{{< /details >}}


{{< details "ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼?" >}}
åˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯è®¡ç®—æœºç¨‹åºçš„é›†åˆï¼Œè¿™äº›ç¨‹åºåˆ©ç”¨è·¨å¤šä¸ªç‹¬ç«‹è®¡ç®—èŠ‚ç‚¹çš„è®¡ç®—èµ„æºæ¥å®ç°å…±åŒçš„ç›®æ ‡ã€‚ å®ƒä¹Ÿè¢«ç§°ä¸ºåˆ†å¸ƒå¼è®¡ç®—æˆ–åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œå¹¶ä¾é ä¸åŒçš„èŠ‚ç‚¹é€šè¿‡å…¬å…±ç½‘ç»œè¿›è¡Œé€šä¿¡å’ŒåŒæ­¥ã€‚ è¿™äº›èŠ‚ç‚¹é€šå¸¸ä»£è¡¨ç‹¬ç«‹çš„ç‰©ç†ç¡¬ä»¶è®¾å¤‡ï¼Œä½†ä¹Ÿå¯ä»£è¡¨å•ç‹¬çš„è½¯ä»¶è¿›ç¨‹æˆ–å…¶ä»–é€’å½’å°è£…çš„ç³»ç»Ÿã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿæ—¨åœ¨æ¶ˆé™¤ç³»ç»Ÿçš„ç“¶é¢ˆæˆ–ä¸­å¿ƒæ•…éšœç‚¹ã€‚
{{< /details >}}

{{< alert icon="ğŸ‘‰" text="å¦‚æœä½ å¯¹è¿™äº›çŸ¥è¯†ä¸äº†è§£ï¼Œè¯·å…ˆè‡ªè¡ŒæŸ¥é˜…ç›¸å…³èµ„æ–™è¿›è¡Œå­¦ä¹ å’Œäº†è§£" />}}


## å¼€å§‹ä¸€ä¸ªæ–°çš„é¡¹ç›®

1.å®‰è£… `Phanes` å‘½ä»¤å·¥å…· â†’ 2.åˆ›å»ºé¡¹ç›® â†’ 3.ç”Ÿæˆä»£ç  â†’ 4.å®‰è£…ä¾èµ– â†’ 5.ä¿®æ”¹é…ç½® â†’ 6.è¿è¡Œä½ çš„é¡¹ç›®.

> æ²¡é”™ï¼Œä»…éœ€6ä¸ªæ­¥éª¤ï¼Œä½ å°±å¯ä»¥è¿è¡Œä½ çš„å¾®æœåŠ¡é¡¹ç›®

### 1.å®‰è£…å‘½ä»¤å·¥å…·

`phanes` å·¥å…·æ­¤é¡¹ç›®çš„çµé­‚ï¼Œä¸€åˆ‡ç”±æ­¤å¼€å§‹...

```bash
go install github.com/phanes-o/phanes@latest
```

### 2.åˆ›å»ºé¡¹ç›® 
ä½¿ç”¨ phanes åˆ›å»ºé¡¹ç›®éå¸¸ç®€å•ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª `hello` é¡¹ç›®ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š

```bash
phanes new hello
```

### 3.ç”Ÿæˆä»£ç 
ç”Ÿæˆä»£ç ä¾èµ–é…ç½®æ–‡ä»¶ `generator.go` æ­¤æ–‡ä»¶ä¹Ÿæ˜¯é»˜è®¤é…ç½®æ–‡ä»¶, å…·ä½“å¦‚ä½•é…ç½®è¯·æŸ¥çœ‹ [ä»£ç ç”Ÿæˆé…ç½®â†’ ]({{< relref "generator" >}})

{{< details "é»˜è®¤é…ç½®ç‚¹è¿™é‡ŒğŸ‘ˆ" >}}
ä½ å¯ä»¥ç›´æ¥å¤åˆ¶æ­¤é…ç½®ç›´æ¥å°è¯•ç”Ÿæˆ User ç›¸å…³ä»£ç 
```go
// Yeah! it's so simple.
package main

import (
  "time"
  "github.com/lib/pq"
)

//project:hello
type  User struct {
  Id int64 `rule:"Parameter;Required"`
  Name string  `rule:"Parameter;Required"`
  Password string `rule:"Parameter;Required"`
  Phone string `rule:"Parameter"`
  Roles []pq.StringArray `rule:"Parameter"`
  CreatedAt time.Time
  UpdatedAt time.Time 
}

```
{{< /details >}}
ä½¿ç”¨é»˜è®¤é…ç½®æ–‡ä»¶ç”Ÿæˆï¼š
```bash
phanes gen
```
æˆ–è€…æŒ‡å®šé…ç½®æ–‡ä»¶ç”Ÿæˆï¼š
```bash
phanes gen -c gen.go
```
{{< details "ç”Ÿæˆäº†ä»€ä¹ˆä»£ç " >}}
phanes æä¾›äº†åŸºæœ¬çš„ crud æ“ä½œçš„æ•´å¥—ä»£ç (HttpApiã€ä¸šåŠ¡ã€modelã€entityã€æ•°æ®å­˜å‚¨ç›¸å…³ä»£ç ) ç”Ÿæˆä»£ç ä¾èµ–é…ç½®æ–‡ä»¶ gnenrator.go æ­¤æ–‡ä»¶åç§°ä¹Ÿæ˜¯é»˜è®¤é…ç½®
{{< /details >}}


### 4.å®‰è£…ä¾èµ–
åˆ«æ€¥ï¼Œé¡¹ç›®å¯åŠ¨ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ‹‰å»é¡¹ç›®çš„ä¾èµ–é¡¹
```bash
go mod tidy
```

### 5.ä¿®æ”¹é¡¹ç›®é…ç½®
æœ€åä¸€æ­¥ï¼ŒçœŸçš„æœ€åä¸€æ­¥ï¼Œå°±æ˜¯ä¿®æ”¹é¡¹ç›®å¯åŠ¨é…ç½®ï¼Œå°±å¯ä»¥å¯åŠ¨é¡¹ç›®äº†, å…·ä½“é…ç½®è¯·æŸ¥çœ‹ [é¡¹ç›®é…ç½®æ–‡ä»¶â†’ ]({{< relref "project" >}})

{{< alert icon="ğŸ‘‰" text="é…ç½®æ–‡ä»¶åœ°å€  `hello/script/config.yaml`" />}}

{{< details "é»˜è®¤é…ç½®ç‚¹è¿™é‡ŒğŸ‘ˆ" >}}
```yaml
name: hello
env: dev
version: 0.1.0
auto_migrate: true

http:
  listen: :7771
  validate_trans: zh

#å¦‚æœä½ åªæƒ³å¿«é€Ÿä½“éªŒï¼Œå¯ä»¥å°† db å’Œ broker é…ç½®æ³¨é‡Šæ‰
db:
  - addr: host=127.0.0.1 user=postgres password=root dbname=auth port=5432
      sslmode=disable TimeZone=Asia/Shanghai
    pwd: root
    type: postgres
    user: root
  - addr: 127.0.0.1:6379
    pwd: ""
    type: redis
    user: ""

broker:
  addr: amqp://coco:kk123123123@127.0.0.1:5672/
  pwd: ""
  type: rabbitmq
  user: ""

# otel config
collect:
  log:
    # DebugLevel = -1, InfoLevel = 0, WarnLevel = 1 ErrorLevel = 2, DPanicLevel = 3, PanicLevel = 4, FatalLevel = 5
    level: -1
    # log file name
    file_name: admin
    # log print prefix
    prefix: "[PHANES]"
    # will buffer up to 4096 kilobytes of logs,
    # waiting at most 10 seconds between flushes.
    buffer_size: 4096 # kb, default 256kb
    interval: 10 # second, default 30s
  metric:
    # metrics will listen a http port
    # example: localhost:2223/metrics
    listen: ":2223"
  trace:
    addr: "http://localhost:14268/api/traces"

traefik:
  # reverse proxy type support: tcp udp http grpc(h2c)
  type: tcp
  # support "||" or "&&"
  rule: "&&"
  # is enable tls
  tls: true
  domain: test.com
  # is enable traefik reverse proxy
  enabled: true
  # match prefix
  # prefix:

```
{{< /details >}}

### 6.è¿è¡Œ(Run your project...)
ç”±äºé¡¹ç›®ä¸ºå¾®æœåŠ¡é¡¹ç›®ï¼Œå¯åŠ¨æ—¶å¿…é¡»ä¾èµ– etcdï¼Œ æ‰€ä»¥éœ€è¦åœ¨å¯åŠ¨ä¹‹å‰è‡³å°‘å¯åŠ¨ etcd

```bash
go run main.go --registry=etcd --registry_address=127.0.0.1:2379 --config=./script/config.yaml
```

å½“ä½ çœ‹åˆ° `finished to init all component` æ—¶ï¼Œ ğŸ‰ğŸ‰æ­å–œä½ ğŸ†ğŸ†ï¼Œ ä½ çš„é¡¹ç›®æˆåŠŸå¯åŠ¨äº†ï¼Œä½¿ç”¨ postman å»è¯·æ±‚ `http://localhost:7771/v1/xxx/xx` ä½“éªŒä½ çš„é¦–ä¸ªPhanes åˆ›å»ºçš„å¾®æœåŠ¡é¡¹ç›®å§

## å¼€å¯æ–°ä¸–ç•Œ

æ›´é«˜çº§çš„ç”¨æ³•è¯·æŸ¥çœ‹ [è¿›é˜¶æ•™ç¨‹ â†’]({{< relref "advance" >}})
